{
    "version": "13.0.0",
    "description": "A parallel computing platform and programming model invented by NVIDIA",
    "homepage": "https://developer.nvidia.com/cuda-toolkit",
    "license": {
        "identifier": "Freeware",
        "url": "https://docs.nvidia.com/cuda/eula/index.html"
    },
    "architecture": {
        "64bit": {
            "url": "http://developer.download.nvidia.com/compute/cuda/13.0.0/local_installers/cuda_13.0.0_windows.exe#/dl.7z",
            "hash": "md5:947db2f0230a3eab645a5a50856f70b9"
        }
    },
    "installer": {
        "script": [
            "$names = @('bin', 'extras', 'include', 'lib', 'libnvvp', 'nvml', 'nvvm', 'compute-sanitizer')",
            "foreach ($name in $names) {",
            "    Copy-Item \"$dir\\cuda_*\\*\\$name\" \"$dir\" -Recurse -Force",
            "    Copy-Item \"$dir\\lib*\\*\\$name\" \"$dir\" -Recurse -Force",
            "}",
            "Get-ChildItem \"$dir\" -Exclude $names | Remove-Item -Recurse -Force",
            "",
            "Write-Host 'Downloading cuDNN...' -ForegroundColor Yellow",
            "if (-not (Get-Command aria2c -ErrorAction SilentlyContinue)) {",
            "    Invoke-WebRequest -Uri 'https://developer.nvidia.com/cudnn-downloads?target_os=Windows&target_arch=x86_64&target_version=Agnostic&cuda_version=12' -OutFile \"$dir\\cudnn.html\"",
            "    $cudnn = Select-String -Path 'cudnn.html' -Pattern 'https://developer.download.nvidia.com/compute/cudnn/redist/cudnn/windows-x86_64/cudnn-windows-x86_64-([\\d.]+)_cuda12-archive.zip' | Select-Object -ExpandProperty Matches | Select-Object -ExpandProperty Value",
            "    Invoke-WebRequest -Uri $cudnn -OutFile \"$dir\\cudnn.zip\"",
            "} else {",
            "    aria2c -x 8 -s 8 -d \"$dir\" -o 'cudnn.html' 'https://developer.nvidia.com/cudnn-downloads?target_os=Windows&target_arch=x86_64&target_version=Agnostic&cuda_version=12'",
            "    $cudnn = Select-String -Path \"$dir\\cudnn.html\" -Pattern 'https://developer.download.nvidia.com/compute/cudnn/redist/cudnn/windows-x86_64/cudnn-windows-x86_64-([\\d.]+)_cuda12-archive.zip' | Select-Object -ExpandProperty Matches | Select-Object -ExpandProperty Value",
            "    aria2c -x 8 -s 8 -d \"$dir\" -o 'cudnn.zip' $cudnn",
            "}",
            "Expand-Archive -Path \"$dir\\cudnn.zip\" -DestinationPath \"$dir\"",
            "$names = @('bin', 'include', 'lib')",
            "foreach ($name in $names) {",
            "    Copy-Item \"$dir\\cudnn-*\\$name\" \"$dir\" -Recurse -Force",
            "}",
            "Remove-Item \"$dir\\cudnn*\" -Recurse"
        ]
    },
    "env_add_path": "bin",
    "env_set": {
        "CUDA_PATH": "$dir"
    },
    "checkver": {
        "url": "https://developer.nvidia.com/cuda-downloads?target_os=Windows&target_arch=x86_64&target_version=11&target_type=exe_local",
        "regex": "/cuda_([\\d._]+)_windows\\.exe"
    },
    "autoupdate": {
        "architecture": {
            "64bit": {
                "url": "http://developer.download.nvidia.com/compute/cuda/$matchHead/local_installers/cuda_$version_windows.exe#/dl.7z"
            }
        },
        "hash": {
            "url": "https://developer.download.nvidia.com/compute/cuda/$matchHead/docs/sidebar/md5sum.txt"
        }
    }
}
